L.Angleicon=L.Icon.extend({options:{angle:0,iconSize:new L.Point(80,60),className:"leaflet-boat-icon",course:0,labelAnchor:[10,-10],pointType:0,ciFlag:!1,label:"",textColor:"red",img:null},createIcon:function(){var t=document.createElement("canvas");this._setIconStyles(t,"icon");var e=this.options.iconSize;return t.width=e.x,t.height=e.y,this.ctx=t.getContext("2d"),this.draw(t.getContext("2d"),e.x,e.y),t},draw:function(t,e,n){if(t){this.x,this.y;var o=this.options.course;if(t.font="10px Courier New",t.fillStyle=this.options.textColor,this.options.ciFlag){var i=this.options.label;t.fillText(i,0,20)}this.drwaImage(t,this.options.img,o,35,20)}},drwaImage:function(t,e,n,o,i){console.log(e.src),e.onload=function(){t.translate(40,30),t.rotate(n),t.translate(-40,-30),t.drawImage(e,o,i),console.log(e.src)}},getAngle:function(t,e){var n=null,o=t.lat2,i=t.lon2,l=e.lat2,a=e.lon2;if(i==a&&o>l)n=Math.PI;else if(i==a&&o<l)n=0;else if(i>a&&o==l)n=-Math.PI/2;else if(i<a&&o==l)n=Math.PI/2;else{var s=t.lat*Math.pow(10,12),r=e.lat*Math.pow(10,12),c=t.lon*Math.pow(10,12),g=e.lon*Math.pow(10,12);n=Math.atan2(g-c,r-s)}return options.angle=n,n},setHeading:function(t){t||(t=options.angle),this.options.course=t%360;this.options.iconSize}}),L.AngleMarker=L.Marker.extend({getAngle:function(t,e){return this.options.icon.getAngle(t,e)},setHeading:function(t){this.options.icon.setHeading(t)}}),L.angleMarker=function(t,e){return e.icon=new L.Angleicon({ciFlag:e.labelFlag,label:e.label,textColor:e.labelColor,img:e.img}),new L.AngleMarker(t,e)};